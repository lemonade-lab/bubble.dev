"use strict";(self.webpackChunkbubble_docs=self.webpackChunkbubble_docs||[]).push([[162],{7904:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>t,default:()=>a,frontMatter:()=>d,metadata:()=>i,toc:()=>c});var r=s(4848),l=s(8453);const d={sidebar_position:6},t="Webhook",i={id:"webhook",title:"Webhook",description:"Webhook \u5141\u8bb8 Bubble \u5e73\u53f0\u901a\u8fc7 HTTP POST \u8bf7\u6c42\u5c06\u4e8b\u4ef6\u63a8\u9001\u5230\u60a8\u7684\u670d\u52a1\u5668\u3002",source:"@site/docs/webhook.md",sourceDirName:".",slug:"/webhook",permalink:"/bubble.dev/docs/webhook",draft:!1,unlisted:!1,editUrl:"https://github.com/lemonade-lab/alemonjs-docs/docs/webhook.md",tags:[],version:"current",sidebarPosition:6,frontMatter:{sidebar_position:6},sidebar:"tutorialSidebar",previous:{title:"WebSocket",permalink:"/bubble.dev/docs/gateway"},next:{title:"API \u53c2\u8003",permalink:"/bubble.dev/docs/api"}},o={},c=[{value:"\u914d\u7f6e Webhook",id:"\u914d\u7f6e-webhook",level:2},{value:"Webhook \u8bf7\u6c42\u683c\u5f0f",id:"webhook-\u8bf7\u6c42\u683c\u5f0f",level:2},{value:"\u8bf7\u6c42\u5934",id:"\u8bf7\u6c42\u5934",level:3},{value:"\u8bf7\u6c42\u4f53",id:"\u8bf7\u6c42\u4f53",level:3},{value:"\u63a5\u6536\u793a\u4f8b",id:"\u63a5\u6536\u793a\u4f8b",level:2},{value:"Express (Node.js)",id:"express-nodejs",level:3},{value:"Flask (Python)",id:"flask-python",level:3},{value:"\u63a8\u9001\u7684\u4e8b\u4ef6\u7c7b\u578b",id:"\u63a8\u9001\u7684\u4e8b\u4ef6\u7c7b\u578b",level:2},{value:"\u5b89\u5168\u9a8c\u8bc1",id:"\u5b89\u5168\u9a8c\u8bc1",level:2},{value:"\u7b7e\u540d\u9a8c\u8bc1\uff08\u5373\u5c06\u652f\u6301\uff09",id:"\u7b7e\u540d\u9a8c\u8bc1\u5373\u5c06\u652f\u6301",level:3},{value:"\u54cd\u5e94\u8981\u6c42",id:"\u54cd\u5e94\u8981\u6c42",level:2},{value:"\u6700\u4f73\u5b9e\u8df5",id:"\u6700\u4f73\u5b9e\u8df5",level:2},{value:"\u5f02\u6b65\u5904\u7406",id:"\u5f02\u6b65\u5904\u7406",level:3},{value:"\u5e42\u7b49\u6027\u5904\u7406",id:"\u5e42\u7b49\u6027\u5904\u7406",level:3},{value:"Webhook vs WebSocket",id:"webhook-vs-websocket",level:2},{value:"\u672c\u5730\u6d4b\u8bd5",id:"\u672c\u5730\u6d4b\u8bd5",level:2},{value:"\u5e38\u89c1\u95ee\u9898",id:"\u5e38\u89c1\u95ee\u9898",level:2}];function h(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"webhook",children:"Webhook"})}),"\n",(0,r.jsx)(n.p,{children:"Webhook \u5141\u8bb8 Bubble \u5e73\u53f0\u901a\u8fc7 HTTP POST \u8bf7\u6c42\u5c06\u4e8b\u4ef6\u63a8\u9001\u5230\u60a8\u7684\u670d\u52a1\u5668\u3002"}),"\n",(0,r.jsx)(n.h2,{id:"\u914d\u7f6e-webhook",children:"\u914d\u7f6e Webhook"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"\u767b\u5f55 Bubble \u5e73\u53f0"}),"\n",(0,r.jsx)(n.li,{children:"\u8fdb\u5165\u300c\u673a\u5668\u4eba\u7ba1\u7406\u300d"}),"\n",(0,r.jsx)(n.li,{children:"\u627e\u5230\u300cWebhook URL\u300d\u8bbe\u7f6e"}),"\n",(0,r.jsx)(n.li,{children:"\u8f93\u5165\u60a8\u7684\u63a5\u6536\u5730\u5740\uff08\u5fc5\u987b\u662f HTTPS\uff09"}),"\n",(0,r.jsx)(n.li,{children:"\u4fdd\u5b58\u914d\u7f6e"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"webhook-\u8bf7\u6c42\u683c\u5f0f",children:"Webhook \u8bf7\u6c42\u683c\u5f0f"}),"\n",(0,r.jsx)(n.h3,{id:"\u8bf7\u6c42\u5934",children:"\u8bf7\u6c42\u5934"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-http",children:"POST /webhook HTTP/1.1\nHost: your-server.com\nContent-Type: application/json\nX-Bubble-Event: MESSAGE_CREATE\nX-Bubble-Signature: sha256=...\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u8bf7\u6c42\u4f53",children:"\u8bf7\u6c42\u4f53"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "type": "MESSAGE_CREATE",\n  "data": {\n    "id": 1001,\n    "channelId": 5,\n    "guildId": 10,\n    "content": "Hello!",\n    "author": {\n      "id": 1,\n      "name": "user"\n    },\n    "timestamp": "2025-12-31T12:00:00Z"\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"\u63a5\u6536\u793a\u4f8b",children:"\u63a5\u6536\u793a\u4f8b"}),"\n",(0,r.jsx)(n.h3,{id:"express-nodejs",children:"Express (Node.js)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"const express = require('express');\nconst app = express();\n\napp.use(express.json());\n\napp.post('/webhook', (req, res) => {\n  const eventType = req.headers['x-bubble-event'];\n  const event = req.body;\n\n  console.log(`\u6536\u5230\u4e8b\u4ef6: ${eventType}`);\n\n  // \u5904\u7406\u4e0d\u540c\u7c7b\u578b\u7684\u4e8b\u4ef6\n  switch (event.type) {\n    case 'MESSAGE_CREATE':\n      handleMessage(event.data);\n      break;\n    case 'GUILD_MEMBER_ADD':\n      handleMemberJoin(event.data);\n      break;\n  }\n\n  // \u5fc5\u987b\u8fd4\u56de 200\n  res.status(200).send('OK');\n});\n\napp.listen(3000);\n"})}),"\n",(0,r.jsx)(n.h3,{id:"flask-python",children:"Flask (Python)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"from flask import Flask, request, jsonify\n\napp = Flask(__name__)\n\n@app.route('/webhook', methods=['POST'])\ndef webhook():\n    event_type = request.headers.get('X-Bubble-Event')\n    event = request.json\n\n    print(f'\u6536\u5230\u4e8b\u4ef6: {event_type}')\n\n    if event['type'] == 'MESSAGE_CREATE':\n        handle_message(event['data'])\n\n    return jsonify({'status': 'ok'}), 200\n\napp.run(port=3000)\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u63a8\u9001\u7684\u4e8b\u4ef6\u7c7b\u578b",children:"\u63a8\u9001\u7684\u4e8b\u4ef6\u7c7b\u578b"}),"\n",(0,r.jsx)(n.p,{children:"Webhook \u4f1a\u63a8\u9001\u6240\u6709\u4e8b\u4ef6\u7c7b\u578b\uff08\u65e0\u6cd5\u9009\u62e9\u6027\u8ba2\u9605\uff09\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"MESSAGE_CREATE"}),"\n",(0,r.jsx)(n.li,{children:"MESSAGE_UPDATE"}),"\n",(0,r.jsx)(n.li,{children:"MESSAGE_DELETE"}),"\n",(0,r.jsx)(n.li,{children:"DM_MESSAGE_CREATE"}),"\n",(0,r.jsx)(n.li,{children:"DM_MESSAGE_UPDATE"}),"\n",(0,r.jsx)(n.li,{children:"DM_MESSAGE_DELETE"}),"\n",(0,r.jsx)(n.li,{children:"GUILD_MEMBER_ADD"}),"\n",(0,r.jsx)(n.li,{children:"GUILD_MEMBER_REMOVE"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["\u5b8c\u6574\u5217\u8868\u8bf7\u53c2\u8003 ",(0,r.jsx)(n.a,{href:"/bubble.dev/docs/events",children:"\u4e8b\u4ef6\u53c2\u8003"}),"\u3002"]}),"\n",(0,r.jsx)(n.h2,{id:"\u5b89\u5168\u9a8c\u8bc1",children:"\u5b89\u5168\u9a8c\u8bc1"}),"\n",(0,r.jsx)(n.h3,{id:"\u7b7e\u540d\u9a8c\u8bc1\u5373\u5c06\u652f\u6301",children:"\u7b7e\u540d\u9a8c\u8bc1\uff08\u5373\u5c06\u652f\u6301\uff09"}),"\n",(0,r.jsx)(n.p,{children:"\u9a8c\u8bc1\u8bf7\u6c42\u6765\u81ea Bubble \u5e73\u53f0\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"const crypto = require('crypto');\n\nfunction verifySignature(payload, signature, secret) {\n  const hmac = crypto.createHmac('sha256', secret);\n  const digest = 'sha256=' + hmac.update(payload).digest('hex');\n  return crypto.timingSafeEqual(\n    Buffer.from(signature),\n    Buffer.from(digest)\n  );\n}\n\napp.post('/webhook', (req, res) => {\n  const signature = req.headers['x-bubble-signature'];\n  const payload = JSON.stringify(req.body);\n  \n  if (!verifySignature(payload, signature, BOT_SECRET)) {\n    return res.status(401).send('Invalid signature');\n  }\n  \n  // \u5904\u7406\u4e8b\u4ef6...\n});\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u54cd\u5e94\u8981\u6c42",children:"\u54cd\u5e94\u8981\u6c42"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u5fc5\u987b\u5728 ",(0,r.jsx)(n.strong,{children:"5 \u79d2\u5185"}),"\u8fd4\u56de HTTP 200"]}),"\n",(0,r.jsx)(n.li,{children:"\u8d85\u65f6\u6216\u8fd4\u56de\u9519\u8bef\u72b6\u6001\u7801\u4f1a\u89e6\u53d1\u91cd\u8bd5\uff081s\u30015s\u300115s\uff0c\u6700\u591a 3 \u6b21\uff09"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"\u6700\u4f73\u5b9e\u8df5",children:"\u6700\u4f73\u5b9e\u8df5"}),"\n",(0,r.jsx)(n.h3,{id:"\u5f02\u6b65\u5904\u7406",children:"\u5f02\u6b65\u5904\u7406"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"app.post('/webhook', async (req, res) => {\n  res.status(200).send('OK'); // \u7acb\u5373\u54cd\u5e94\n  \n  setImmediate(() => processEvent(req.body)); // \u5f02\u6b65\u5904\u7406\n});\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u5e42\u7b49\u6027\u5904\u7406",children:"\u5e42\u7b49\u6027\u5904\u7406"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"const processedEvents = new Set();\n\nfunction handleEvent(event) {\n  const eventId = `${event.type}-${event.data.id}`;\n  if (processedEvents.has(eventId)) return;\n  \n  processedEvents.add(eventId);\n  // \u5904\u7406\u4e8b\u4ef6...\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"webhook-vs-websocket",children:"Webhook vs WebSocket"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"\u7279\u6027"}),(0,r.jsx)(n.th,{children:"Webhook"}),(0,r.jsx)(n.th,{children:"WebSocket"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"\u8fde\u63a5\u65b9\u5f0f"}),(0,r.jsx)(n.td,{children:"\u88ab\u52a8\u63a5\u6536"}),(0,r.jsx)(n.td,{children:"\u4e3b\u52a8\u8fde\u63a5"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"\u5b9e\u65f6\u6027"}),(0,r.jsx)(n.td,{children:"\u7565\u6709\u5ef6\u8fdf"}),(0,r.jsx)(n.td,{children:"\u5b9e\u65f6"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"\u4e8b\u4ef6\u8ba2\u9605"}),(0,r.jsx)(n.td,{children:"\u63a5\u6536\u6240\u6709\u4e8b\u4ef6"}),(0,r.jsx)(n.td,{children:"\u53ef\u9009\u62e9\u8ba2\u9605"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"\u670d\u52a1\u5668\u8981\u6c42"}),(0,r.jsx)(n.td,{children:"\u9700\u8981\u516c\u7f51\u5730\u5740"}),(0,r.jsx)(n.td,{children:"\u65e0\u9700\u516c\u7f51"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"\u9002\u7528\u573a\u666f"}),(0,r.jsx)(n.td,{children:"\u751f\u4ea7\u73af\u5883"}),(0,r.jsx)(n.td,{children:"\u5f00\u53d1\u6d4b\u8bd5"})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"\u672c\u5730\u6d4b\u8bd5",children:"\u672c\u5730\u6d4b\u8bd5"}),"\n",(0,r.jsx)(n.p,{children:"\u4f7f\u7528 ngrok \u7b49\u5de5\u5177\u5c06\u672c\u5730\u670d\u52a1\u66b4\u9732\u5230\u516c\u7f51\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ngrok http 3000\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u5e38\u89c1\u95ee\u9898",children:"\u5e38\u89c1\u95ee\u9898"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Q: \u9700\u8981\u516c\u7f51 IP \u5417\uff1f"})}),"\n",(0,r.jsx)(n.p,{children:"A: \u662f\u7684\uff0cWebhook URL \u5fc5\u987b\u53ef\u4ee5\u4ece\u516c\u7f51\u8bbf\u95ee\u3002"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Q: \u652f\u6301 HTTP \u5417\uff1f"})}),"\n",(0,r.jsx)(n.p,{children:"A: \u4e0d\u652f\u6301\uff0c\u5fc5\u987b\u4f7f\u7528 HTTPS\u3002"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Q: \u5982\u4f55\u8fc7\u6ee4\u4e0d\u9700\u8981\u7684\u4e8b\u4ef6\uff1f"})}),"\n",(0,r.jsx)(n.p,{children:"A: \u5728\u670d\u52a1\u5668\u7aef\u6839\u636e event.type \u8fdb\u884c\u8fc7\u6ee4\u3002"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Q: \u8d85\u65f6\u4f1a\u600e\u6837\uff1f"})}),"\n",(0,r.jsx)(n.p,{children:"A: \u8d85\u8fc7 5 \u79d2\u672a\u54cd\u5e94\u4f1a\u89e6\u53d1\u91cd\u8bd5\u3002"}),"\n",(0,r.jsxs)(n.p,{children:["\u66f4\u591a\u4fe1\u606f\u8bf7\u53c2\u8003 ",(0,r.jsx)(n.a,{href:"/bubble.dev/docs/architecture",children:"\u67b6\u6784\u8bf4\u660e"}),"\u3002"]})]})}function a(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>i});var r=s(6540);const l={},d=r.createContext(l);function t(e){const n=r.useContext(d);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:t(e.components),r.createElement(d.Provider,{value:n},e.children)}}}]);